//source: https://gist.github.com/pbellon/d397cbdfc596f1724860b60a1d41be43 license: mit
d3.concaveHull=function(){function n(n,r){var t=n[0]-r[0],a=n[1]-r[1];return Math.sqrt(t*t+a*a)}function r(r){o=d3.voronoi().triangles(r);var a=i(o);mesh=o.filter(function(r){return n(r[0],r[1])<a&&n(r[0],r[2])<a&&n(r[1],r[2])<a});var u,c={},h={},s=[];for(mesh.forEach(function(n){for(var r=0;r<3;r++){var t=[n[r],n[(r+1)%3]].sort(e).map(String);(h[t[0]]=h[t[0]]||[]).push(t[1]),(h[t[1]]=h[t[1]]||[]).push(t[0]);var a=t.join(":");c[a]?delete c[a]:c[a]=1}});;){var v=null;for(v in c)break;if(null==v)break;s.push(u=v.split(":").map(function(n){return n.split(",").map(Number)})),delete c[v];for(var l=u[1];l[0]!==u[0][0]||l[1]!==u[0][1];)for(var p=l,d=h[p.join(",")],m=d.length,y=0;y<m;y++){var g=[p,l=d[y].split(",").map(Number)].sort(e).join(":");if(c[g]){delete c[g],u.push(l);break}}}return 0!==f&&(s=t(s,f)),s}function t(n,r){var t=[];return n.forEach(function(n){var e=[],o=0;n.forEach(function(r,t){var a=t-1;0==t&&(a=n.length-1);var u=n[a];o+=(r[0]-u[0])*(r[1]+u[1])/2});var i=1;o>0&&(i=-1),n.forEach(function(t,o){var f=o-1;0==o&&(f=n.length-2);var c=u(a(t,n[f]),90*i);e.push([t[0]+c.x*r,t[1]+c.y*r])}),t.push(e)}),t}function a(n,r){var t={x:r[0]-n[0],y:r[1]-n[1]},a=Math.sqrt(t.x*t.x+t.y*t.y);return t.x/=a,t.y/=a,t}function u(n,r){return r*=Math.PI/180,{x:n.x*Math.cos(r)-n.y*Math.sin(r),y:n.x*Math.sin(r)+n.y*Math.cos(r)}}function e(n,r){return n[0]===r[0]?r[1]-n[1]:r[0]-n[0]}var o,i=function(r){var t=[];r.forEach(function(r){t.push(n(r[0],r[1])),t.push(n(r[0],r[2])),t.push(n(r[1],r[2]))});var a=d3.deviation(t);return d3.mean(t)+a},f=0;return r.padding=function(n){return arguments.length?(f=n,r):f},r.distance=function(n){return arguments.length?(i=n,"number"==typeof n&&(i=function(){return n}),r):i},r};